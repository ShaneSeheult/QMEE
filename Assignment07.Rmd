---
title: "Untitled"
author: "Shane"
date: "02/03/2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This assignment is meant to be run from the main repo directory.

## Libraries
```{r, echo = FALSE, warning=FALSE, error=FALSE}
library(tidyverse)
library(ggplot2)
library(ggpubr)
library(performance)
library(plotrix)
library(dotwhisker)
library(randomForest)
library(emmeans)
library(DHARMa)
```

## Load Data
```{r}
dd <- readRDS("PupBirthdaysClean.rds")
summary(dd)
```
## Hypothesis
Note, A hypothesis for my project can be found within the following directory: ShaneSeheult/QMEE/Assignment04/QMEE_assignment_04.pdf

I have copied the text from this assignment and pasted it below:

My null hypothesis (h0) is that there is no difference between birthdays of pupsborn to wild-caught or captive bats. In other words, the pups are drawn from the same population. My alternaitve hypothesis (h1) is that pups born from Captive bats will give birth earlier compared to Wild-Caught bats. 

## General Linear Model
Since my response variable **Julian.Date** is a continuous variable and is positively skewed, I believe it is more appropriate to use family = Gamma as opposed to family = Poisson. I will also follow the advice providied in class and set the link function = "log"

```{r}
Birth.glm.mod_02 <- glm(Julian.Date ~ Group, data = dd, family = Gamma(link = "log"))
summary(Birth.glm.mod_02)
```

## Diagnostic Plot 
```{r}
plot(Birth.glm.mod)

acf(residuals(Birth.glm.mod))
```



## Test of Using Family
```{r}
Birth.glm.mod.gamma <- update(Birth.glm.mod, family = Gamma(link = "log"))
simulateResiduals(Birth.glm.mod.gamma, plot = TRUE)
```


```{r}

Figure_01 <- ggplot(dd, aes(Group,Julian.Date)) +
  geom_point() +
  geom_smooth(method = "glm", color = "red", formula = y~x, method.args = list(family = "Gamma"))
Figure_01

```

The following is a recreation from code provided as feedback from a previous assignment where I fit a linear model to the data.
```{r}
h <- broom::augment(Birth.glm.mod)
gg0 <- ggplot(h, aes(x= Group, y = sqrt(abs(.std.resid)))) + stat_sum()
sm <- geom_smooth(method = "glm", formula = y~x, method.args = list(family = "Gamma"), aes(group = 1))
print(gg0 + sm)
gg1 <- gg0 + aes(x=.fitted)
print(gg1+sm)
```
## Inferential Plot

```{r}
emm.glm.mod <- emmeans(Birth.glm.mod, spec = ~ Group)
plot(pairs(emm.glm.mod)) + geom_vline(xintercept = c(0,-7,7), lty = 2) + xlim(-10,10) 
plot(pairs(emm.glm.mod)) + geom_vline(xintercept = 0, lty = 2)
```
Note, the two plots here are showing the same estimate. The difference between the two plots is the x-axis scale: the first plot includes the
meaningfully relevant bounds of a difference of 7 days. See below for more details regarding the choice for these bounds. These results suggest an incredibly small, negative effect of Group such that pups born from Captive bats tend to be born earlier compared to pups born from wild-caught bats.


## Biologically Meaningful Equivalence Bounds

The following describes the development of a meaningful scale for data interpretation:

A summary of these developmental milestones for big brown bats reported by Mayberry & Faure (2014) include:

- **Eyes:** eyes open at post natal dat (PND) 2/3
- **Hair:** grows sparse at PND 4, covers the body by PND 7/8, and becomes coarse by PND 8/9, and adult like-by PND 10/11
- **Flight:** pups make flight attempts around PND7/8 by flapping their wings while hanging. Pups begin hopping by PND 13, pefrom controlled falls / flight attempts by PND 21, and achieve true powered flight by PND 27/28.
- **Attachment to Mother:** pups tend to stop weaning by PND 13/14.

The authors suggest that "because newborn pups are altrical they are very dependent on their mother for nutrition, warmth and protection and are consistently found attached to and nursing from her until PND 13/14" (Mayberry and Faure, 2014). For these reasons, I will designate the meaningfully relevant measure of effect to be set at 14 days (i.e. 2 weeks) as the pups development would be drastically lagged. I would designate the grey area to start at 7 days (i.e. 1 week)

For this reason, I will focus on the positive measure of effect, but these regions would be symmetrical around 0. Based on the developmental milestones presented in Mayberry & Faure (2014), I would designate an effect size of 14 days to have meaningful biological relevance. **Note:** although inspired from the literature, these relevance splits were influenced by a humanistic interpretation (taking days on the order of weeks) and thus should be taken lightly, not as hard thresholds, when interpreting the data.

**Citation:** Mayberry, HW and Faure PA. (2014). Morphological, olfactory, and vocal development in big brown bats. *Biology Open* 4(1), 22-34.


